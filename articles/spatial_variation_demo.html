<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation of plot errors and phenotypes in a plant breeding field trial • FieldSimR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation of plot errors and phenotypes in a plant breeding field trial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FieldSimR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/compound_symmetry_GxE_demo.html">Simulation of genetic values based on a compound symmetry model for genotype-by-environment (GxE) interaction</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_variation_demo.html">Simulation of plot errors and phenotypes in a plant breeding field trial</a></li>
    <li><a class="dropdown-item" href="../articles/unstructured_GxE_demo.html">Simulation of genetic values based on an unstructured model for genotype-by-environment (GxE) interaction</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/crWerner/fieldsimr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation of plot errors and phenotypes in a plant breeding field trial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/crWerner/fieldsimr/blob/main/vignettes/spatial_variation_demo.Rmd" class="external-link"><code>vignettes/spatial_variation_demo.Rmd</code></a></small>
      <div class="d-none name"><code>spatial_variation_demo.Rmd</code></div>
    </div>

    
    
<p><br></p>
<div class="section level3">
<h3 id="background">
<strong>Background</strong><a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>The <strong>R package <a href="https://cran.r-project.org/package=FieldSimR" class="external-link">‘FieldSimR’</a></strong>
enables simulation of multi-environment plant breeding trial phenotypes
through the simulation of plot errors and their subsequent combination
with (simulated) genetic values. Its <strong>core function generates
plot errors</strong> comprising 1) a spatially correlated error term, 2)
a random error term, and 3) an extraneous error term. Spatially
correlated errors are simulated using either bivariate interpolation, or
a two-dimensional autoregressive process of order one (AR1:AR1).The
three error terms are combined at a user-deﬁned ratio.</p>
<p><strong>This document demonstrates how to:</strong></p>
<ol style="list-style-type: decimal">
<li>Simulate plot errors for multiple traits tested in multiple
environments, and</li>
<li>Simulate phenotypes through the combination of the plot errors with
simulated genetic values.</li>
</ol>
<p><br></p>
<p>The <strong>simulation of plot errors</strong> requires specification
of various simulation parameters that define:</p>
<ol style="list-style-type: decimal">
<li>The field trial layout</li>
<li>The total error variance</li>
<li>The spatial error</li>
<li>Extraneous variation</li>
</ol>
<p><br></p>
<p><strong>Phenotypes</strong> are then simulated through the
combination of the plot errors with the genetic values stored in the
package’s example data frame <code>gv_df_unstr</code>. The data frame
contains simulated genetic values for two traits in three environments
based on an unstructured model for genotype-by-environment (GxE)
interaction. The simulation of the genetic values is shown in the
vignette on the <a href="https://crwerner.github.io/fieldsimr/articles/unstructured_GxE_demo.html">Simulation
of genetic values based on an unstructured model for
genotype-by-environment (GxE) interaction</a>.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="simulation-of-plot-errors">
<strong>1. Simulation of plot errors</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-errors"></a>
</h3>
<div class="section level4">
<h4 id="field-trial-layout">
<strong>1.1 Field trial layout</strong><a class="anchor" aria-label="anchor" href="#field-trial-layout"></a>
</h4>
<p>We conceive a scenario in which 100 maize hybrids are measured for
grain yield (t/ha) and plant height (cm) in three environments. The
first and the third environment include two blocks, and the second
environment includes three blocks. Each block comprises 20 rows and 5
columns. The blocks are arranged in column direction (“side-by-side”).
The plot length (column direction) is 8 meters, and the plot width (row
direction) is 2 meters.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ntraits</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Number of traits</span></span>
<span><span class="va">nenvs</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Number of environments</span></span>
<span><span class="va">nblocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># Number of blocks per environment</span></span>
<span><span class="va">block_dir</span> <span class="op">&lt;-</span> <span class="st">"col"</span> <span class="co"># Arrangement of blocks ("side-by-side")</span></span>
<span><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span> <span class="co"># Number of columns per environment</span></span>
<span><span class="va">nrows</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="co"># Number of rows per environment</span></span>
<span><span class="va">plot_length</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># Plot length; here in meters (column direction)</span></span>
<span><span class="va">plot_width</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Plot width; here in meters (row direction)</span></span></code></pre></div>
<p><strong>Note:</strong> <code>plot_length</code> and
<code>plot_width</code> are only required when
<code>spatial_model = "Bivariate"</code>. The two arguments are used to
set the x-coordinates and y-coordinates required for the bivariate
interpolation algorithm to model a spatial correlation between plots.
Therefore, the assumed unit of length (meters here) has no actual
meaning, and the ratio between <code>plot_length</code> and
<code>plot_width</code> is important rather than the absolute values. We
recommend to use realistic, absolute values for <code>plot_length</code>
and <code>plot_width</code> regardless of the unit of length.</p>
<p>When spatially correlated errors are simulated based on a
<strong>two-dimensional autoregressive process (AR1:AR1)</strong>,
<code>col_cor</code> and <code>row_cor</code> have to be defined
instead.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="total-error">
<strong>1.2 Total error</strong><a class="anchor" aria-label="anchor" href="#total-error"></a>
</h4>
<p>To obtain pre-defined target heritabilities at the plot-level, we
need to define the total error variances for the two simulated traits
relative to their genetic variances. We assume broad-sense
heritabilities at the plot level of
<strong><em>H<sup>2</sup></em></strong> <strong>= 0.3 for grain
yield</strong> and <strong><em>H<sup>2</sup></em></strong> <strong>= 0.5
for plant height</strong> at all three environments. The heritabilities
for the six trait x environment combinations are stored in a single
vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span></code></pre></div>
<p><br></p>
<p>The total genetic variances of the six trait x environment
combinations (environments nested within traits) can be extracted from
the description of the simulation of the genetic values in
FieldSimR::unstructured_GxE_demo.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.086</span>, <span class="fl">0.12</span>, <span class="fl">0.06</span>, <span class="fl">15.1</span>, <span class="fl">8.5</span>, <span class="fl">11.7</span><span class="op">)</span> <span class="co"># c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span></code></pre></div>
<p><br></p>
<p>We now create a simple function to calculate the total error
variances based on our pre-defined target heritabilities in vector
<code>H2</code>and the total genetic variances in <code>var</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculation of error variances based on the genetic variance and target heritability vectors.</span></span>
<span><span class="va">calc_varR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var</span>, <span class="va">H2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">varR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">var</span> <span class="op">/</span> <span class="va">H2</span><span class="op">)</span> <span class="op">-</span> <span class="va">var</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">varR</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">varR</span> <span class="op">&lt;-</span> <span class="fu">calc_varR</span><span class="op">(</span><span class="va">var</span>, <span class="va">H2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">varR</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># Vector of error variances: c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span>
<span><span class="co">#&gt; [1]  0.20  0.28  0.14 15.10  8.50 11.70</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="spatial-error">
<strong>1.3 Spatial error</strong><a class="anchor" aria-label="anchor" href="#spatial-error"></a>
</h4>
<p>We simulate a spatial error term using bivariate interpolation and
assume the proportion of spatial error variance to total error variance
to be 0.4 in all three environments. Additionally, we assume a
correlation between the spatial error of the two traits. However, since
we have no information on the magnitude of the correlation, we randomly
sample a value between 0 and 0.5.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_model</span> <span class="op">&lt;-</span> <span class="st">"Bivariate"</span> <span class="co"># Spatial error model.</span></span>
<span><span class="va">prop_spatial</span> <span class="op">&lt;-</span> <span class="fl">0.4</span> <span class="co"># Proportion of spatial trend.</span></span>
<span></span>
<span><span class="va">ScorR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rand_cor_mat.html">rand_cor_mat</a></span><span class="op">(</span><span class="va">ntraits</span>, min.cor <span class="op">=</span> <span class="fl">0</span>, max.cor <span class="op">=</span> <span class="fl">0.5</span>, pos.def <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'cor_mat' is already positive (semi)-definite, matrix was not altered</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ScorR</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      1    2</span></span>
<span><span class="co">#&gt; 1 1.00 0.04</span></span>
<span><span class="co">#&gt; 2 0.04 1.00</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="extraneous-variation">
<strong>1.4 Extraneous variation</strong><a class="anchor" aria-label="anchor" href="#extraneous-variation"></a>
</h4>
<p>Extraneous effects can, for example, result from trial management
procedures in row and/or column direction, such as soil tillage, sowing
or harvesting. We want to simulate extraneous variation in row direction
and assume the proportion of extraneous error variance to total error
variance to be 0.2. We assume a correlation between the error of the two
traits because of extraneous variation and randomly sample a value
between 0 and 0.5.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext_ord</span> <span class="op">&lt;-</span> <span class="st">"zig-zag"</span></span>
<span><span class="va">ext_dir</span> <span class="op">&lt;-</span> <span class="st">"row"</span></span>
<span><span class="va">prop_ext</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span></span>
<span><span class="va">EcorR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rand_cor_mat.html">rand_cor_mat</a></span><span class="op">(</span><span class="va">ntraits</span>, min.cor <span class="op">=</span> <span class="fl">0</span>, max.cor <span class="op">=</span> <span class="fl">0.5</span>, pos.def <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'cor_mat' is already positive (semi)-definite, matrix was not altered</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">EcorR</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      1    2</span></span>
<span><span class="co">#&gt; 1 1.00 0.42</span></span>
<span><span class="co">#&gt; 2 0.42 1.00</span></span></code></pre></div>
<p><strong>Note:</strong> the <strong>proportion of the random error
variance to total error variance</strong> is defined as 1 -
(prop_spatial + prop_ext). Hence, <code>prop_spatial</code> and
<code>prop_ext</code> are set with reference to the random error, and
the sum of the two proportions must not be greater than 1.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="simulation-of-plot-errors-1">
<strong>1.5 Simulation of plot errors</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-errors-1"></a>
</h4>
<p>Finally, we use all the parameters defined above with the function
<code><a href="../reference/field_trial_error.html">field_trial_error()</a></code> to simulate plot errors for grain yield
and plant height in the three test environments:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/field_trial_error.html">field_trial_error</a></span><span class="op">(</span></span>
<span>  ntraits <span class="op">=</span> <span class="va">ntraits</span>,</span>
<span>  nenvs <span class="op">=</span> <span class="va">nenvs</span>,</span>
<span>  nblocks <span class="op">=</span> <span class="va">nblocks</span>,</span>
<span>  block.dir <span class="op">=</span> <span class="va">block_dir</span>,</span>
<span>  ncols <span class="op">=</span> <span class="va">ncols</span>,</span>
<span>  nrows <span class="op">=</span> <span class="va">nrows</span>,</span>
<span>  plot.length <span class="op">=</span> <span class="va">plot_length</span>,</span>
<span>  plot.width <span class="op">=</span> <span class="va">plot_width</span>,</span>
<span>  varR <span class="op">=</span> <span class="va">varR</span>,</span>
<span>  ScorR <span class="op">=</span> <span class="va">ScorR</span>,</span>
<span>  EcorR <span class="op">=</span> <span class="va">EcorR</span>,</span>
<span>  RcorR <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spatial.model <span class="op">=</span> <span class="va">spatial_model</span>,</span>
<span>  prop.spatial <span class="op">=</span> <span class="va">prop_spatial</span>,</span>
<span>  ext.ord <span class="op">=</span> <span class="va">ext_ord</span>,</span>
<span>  ext.dir <span class="op">=</span> <span class="va">ext_dir</span>,</span>
<span>  prop.ext <span class="op">=</span> <span class="va">prop_ext</span>,</span>
<span>  return.effects <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> by default, the function
<code><a href="../reference/field_trial_error.html">field_trial_error()</a></code> generates a data frame with the
following columns: <strong><em>environment id</em></strong>
(environment), <strong><em>block id</em></strong>, <strong><em>column
id</em></strong>, <strong><em>row id</em></strong>, and the
<strong><em>total plot error for each trait</em></strong>. When
<code>return_effects = TRUE</code>, <a href="https://cran.r-project.org/package=FieldSimR" class="external-link">‘FieldSimR’</a>
returns a list with an additional entry for each trait containing the
spatial error, the extraneous effect and the random error.</p>
<p><br></p>
<p>We will now plot the <strong>total error for grain yield (“e.Trait1”)
in Environment 1</strong>, as well as the <strong>spatial error
component</strong>, the <strong>random error component</strong>, and the
<strong>extraneous variation</strong>. Therefore, we first extract the
required data from <code>error_df</code> and then create an individual
graphic for each of the four simulated error terms.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_total_env1</span> <span class="op">&lt;-</span> <span class="va">error_ls</span><span class="op">$</span><span class="va">error.df</span><span class="op">[</span><span class="va">error_ls</span><span class="op">$</span><span class="va">error.df</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">e_terms_env1</span> <span class="op">&lt;-</span> <span class="va">error_ls</span><span class="op">$</span><span class="va">Trait1</span><span class="op">[</span><span class="va">error_ls</span><span class="op">$</span><span class="va">Trait1</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p><br></p>
<p><strong>Total plot error</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_total_env1</span>, effect <span class="op">=</span> <span class="st">"e.Trait1"</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Spatial error</strong> simulated using bivariate
interpolation</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_terms_env1</span>, effect <span class="op">=</span> <span class="st">"e.spat"</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Random error</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_terms_env1</span>, effect <span class="op">=</span> <span class="st">"e.rand"</span>, labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-12-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Extraneous variation </strong>in the row direction</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_terms_env1</span>, effect <span class="op">=</span> <span class="st">"e.ext.row"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-13-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="simulation-of-plot-level-phenotypes">
<strong>2. Simulation of plot-level phenotypes</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-level-phenotypes"></a>
</h3>
<p>To simulate <strong>grain yield and plant height phenotypes</strong>
for our multi-environment maize experiment, we now combine the simulated
plot errors with the genetic values stored in the example data frame
<code>gv_df_unstr</code>. This is done using the function
<code><a href="../reference/make_phenotypes.html">make_phenotypes()</a></code>, which allocates genotypes to plots
within blocks according to a randomized complete block design
(RCBD).</p>
<p><strong>Note:</strong> more complex field designs require allocation
of genotypes to plots using an external R package or software.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gv_df</span> <span class="op">&lt;-</span> <span class="va">gv_df_unstr</span></span>
<span></span>
<span><span class="va">pheno_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_phenotypes.html">make_phenotypes</a></span><span class="op">(</span></span>
<span>  <span class="va">gv_df</span>,</span>
<span>  <span class="va">error_ls</span><span class="op">$</span><span class="va">error.df</span>,</span>
<span>  randomise <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pheno_env1</span> <span class="op">&lt;-</span> <span class="va">pheno_df</span><span class="op">[</span><span class="va">pheno_df</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="co"># Extract phenotypes in environment 1.</span></span></code></pre></div>
<p><br></p>
<p><strong>Simulated phenotypes</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">pheno_env1</span>, effect <span class="op">=</span> <span class="st">"y.Trait1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-15-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Histogram showing the phenotypes of the 100 maize hybrids for
grain yield in the two blocks in Environment 1</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pheno_env1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">y.Trait1</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">block</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#e9ecef"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violetred3"</span>, <span class="st">"goldenrod3"</span>, <span class="st">"skyblue2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Phenotypes for grain yield (t/ha)"</span>, y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Block"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_variation_demo_files/figure-html/unnamed-chunk-16-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Werner, Daniel Tolhurst.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
